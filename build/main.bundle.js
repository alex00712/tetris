!function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(t,e,s,i){this.parent=t,this.cell=e,this.height=2*e,this.width=e*s,this.buttom_lenght=this.width/4,this.callback=t=>{t.offsetX<=this.buttom_lenght?i("left"):t.offsetX>this.buttom_lenght&&t.offsetX<=2*this.buttom_lenght?i("rotate"):t.offsetX>2*this.buttom_lenght&&t.offsetX<=3*this.buttom_lenght?i("down"):i("right")},this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","canv_control"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.parent.appendChild(this.canvas),this.canvas.addEventListener("click",t=>{this.callback(t)})}drow_buttoms(){for(let t=0;t<4;t++)switch(this.context.beginPath(),this.context.moveTo(t*this.buttom_lenght,0),this.context.lineTo(t*this.buttom_lenght,2*this.cell),this.context.stroke(),t){case 0:this.context.beginPath(),this.context.moveTo(2*this.buttom_lenght/3,this.height/5),this.context.lineTo(2*this.buttom_lenght/3,4*this.height/5),this.context.lineTo(this.buttom_lenght/3,this.height/2),this.context.fill();break;case 1:this.context.beginPath(),this.context.arc(3*this.width/8,this.height/2,3*this.height/10,0,2*Math.PI,!0),this.context.stroke();break;case 2:this.context.beginPath(),this.context.moveTo(this.buttom_lenght*t+this.buttom_lenght/3,this.height/5),this.context.lineTo(this.buttom_lenght*t+2*this.buttom_lenght/3,this.height/5),this.context.lineTo(this.buttom_lenght*t+this.buttom_lenght/2,4*this.height/5),this.context.fill();break;case 3:this.context.beginPath(),this.context.moveTo(this.buttom_lenght*t+this.buttom_lenght/3,this.height/5),this.context.lineTo(this.buttom_lenght*t+this.buttom_lenght/3,4*this.height/5),this.context.lineTo(this.buttom_lenght*t+2*this.buttom_lenght/3,this.height/2),this.context.fill()}}}class h{constructor(t,e,s,h,n,o){this.reset=o,this.data=t,this.playfield=e,this.control_panel=new i(s,h,n,this.control_touch.bind(this)),this.control_panel.drow_buttoms(),this.playfield.render_playfield(this.data.state.map,this.data.state.next_piese,this.data.state.score),this.game_circle=()=>{},document.addEventListener("keydown",this.control_key_down.bind(this))}control_key_down(t){switch(t.keyCode){case 37:this.left();break;case 38:this.rotate();break;case 39:this.right();break;case 40:this.down()}}control_touch(t){switch(t){case"right":this.right();break;case"left":this.left();break;case"rotate":this.rotate();break;case"down":this.down()}}down(){if(this.data.move_piese_down(),this.playfield.render_playfield(this.data.state.map,this.data.state.next_piese,this.data.state.score),this.data.is_lose()){const t=this.reset,e=this.data.state.score;this.playfield.drow_loser(e),this.stop_the_game(),document.addEventListener("click",(function s(){document.removeEventListener("click",s),localStorage.getItem("tetris_score")<e&&localStorage.setItem("tetris_score",e),t()}))}}right(){this.data.move_piese_right(),this.playfield.render_playfield(this.data.state.map,this.data.state.next_piese,this.data.state.score)}left(){this.data.move_piese_left(),this.playfield.render_playfield(this.data.state.map,this.data.state.next_piese,this.data.state.score)}rotate(){this.data.rotate_piese(),this.playfield.render_playfield(this.data.state.map,this.data.state.next_piese,this.data.state.score)}set_game_circle(){this.game_circle=setInterval(()=>{this.down()},800)}stop_the_game(){clearInterval(this.game_circle)}}class n{constructor(){this.count=0,this.variants_of_T_elemnt=this.constructor.createPiese()}static createPiese(){switch(Math.floor(7*Math.random())+1){case 1:return{0:[[1,1,1,1]],1:[[1],[1],[1],[1]],2:[[1,1,1,1]],3:[[1],[1],[1],[1]]};case 2:return{0:[[0,2,0],[2,2,2]],1:[[2,0],[2,2],[2,0]],2:[[2,2,2],[0,2,0]],3:[[0,2],[2,2],[0,2]]};case 3:return{0:[[0,0,3],[3,3,3]],1:[[3,0],[3,0],[3,3]],2:[[3,3,3],[3,0,0]],3:[[3,3],[0,3],[0,3]]};case 4:return{0:[[4,0,0],[4,4,4]],1:[[4,4],[4,0],[4,0]],2:[[4,4,4],[0,0,4]],3:[[0,4],[0,4],[4,4]]};case 5:return{0:[[5,5],[5,5]],1:[[5,5],[5,5]],2:[[5,5],[5,5]],3:[[5,5],[5,5]]};case 6:return{0:[[0,6,6],[6,6,0]],1:[[6,0],[6,6],[0,6]],2:[[0,6,6],[6,6,0]],3:[[6,0],[6,6],[0,6]]};case 7:return{0:[[7,7,0],[0,7,7]],1:[[0,7],[7,7],[7,0]],2:[[7,7,0],[0,7,7]],3:[[0,7],[7,7],[7,0]]}}}rotate(){3!==this.count?this.count+=1:this.count=0}rotateBack(){0!==this.count?this.count-=1:this.count=3}get el(){return this.variants_of_T_elemnt[this.count]}}class o{constructor(t,e){this.score=0,this.y=e,this.x=t,this.map=new Array(this.y);for(var s=0;s<this.y;s++){this.map[s]=new Array(this.x);for(var i=0;i<this.x;i++)this.map[s][i]=0}this.next_piese=this.generat_piese(),this.current_piese=this.generat_piese()}rotate_piese(){this.current_piese.piese.rotate(),this.is_piese_on_field()&&this.current_piese.piese.rotateBack(),4===this.current_piese.piese.el[0].length&&(this.current_piese.x-=2),1===this.current_piese.piese.el[0].length&&(this.current_piese.x+=2),this.is_piese_out_of_field((t,e)=>{switch(e){case-1:this.current_piese.x+=1;break;case 8:this.current_piese.x-=1;break;case-2:this.current_piese.x+=2}})}move_piese_left(){this.current_piese.x-=1,this.is_piese_out_of_field()&&(this.current_piese.x+=1)}move_piese_right(){this.current_piese.x+=1,this.is_piese_out_of_field()&&(this.current_piese.x-=1)}move_piese_down(){this.current_piese.y+=1,this.is_piese_out_of_field()&&(this.current_piese.y-=1,this.lock_piese_on_the_map())}is_piese_out_of_field(t){const e=this.current_piese.piese.el,{x:s,y:i}=this.current_piese;for(let h=0;h<e.length;h++)for(let n=0;n<e[h].length;n++)if(!(0===e[h][n]||0===this.map[i+h]&&0===this.map[i+h][s+n]||void 0!==this.map[i+h]&&void 0!==this.map[i+h][s+n]&&0===this.map[i+h][s+n]))return t&&t(i+h,s+n),!0;return!1}is_piese_on_field(){const t=this.current_piese.piese.el,{x:e,y:s}=this.current_piese;for(let i=0;i<t.length;i++)for(let h=0;h<t[i].length;h++)if(0!==this.map[s+i][e+h]&&0!==t[i][h])return!0;return!1}lock_piese_on_the_map(){const t=this.current_piese.piese.el,{x:e,y:s}=this.current_piese;for(let i=0;i<t.length;i++)for(let h=0;h<t[i].length;h++)0===this.map[s+i][e+h]&&(this.map[s+i][e+h]=t[i][h]);this.update_pieses(),this.remove_line()}generat_piese(){return{x:2,y:0,piese:new n}}update_pieses(){this.current_piese=this.next_piese,this.next_piese=this.generat_piese()}remove_line(){let t=[];for(let e=0;e<this.map.length;e++){let s=!0;for(let t=0;t<this.map[e].length;t++)s=s&&this.map[e][t];s&&t.push(e)}if(0!==t.length){for(let e=0;e<t.length;e++){let s=new Array(this.x);for(let t=0;t<s.length;t++)s[t]=0;this.map.splice(t[e],1),this.map.unshift(s)}this.update_score(t.length)}}update_score(t){this.score+=200*(t-1)+100}build_map_for_render(){const t=new Array(this.y);for(let e=0;e<this.map.length;e++){t[e]=new Array(this.x);for(let s=0;s<this.map[e].length;s++)t[e][s]=this.map[e][s]}const e=this.current_piese.piese.el,{x:s,y:i}=this.current_piese;for(let h=0;h<e.length;h++)for(let n=0;n<e[h].length;n++)0===t[i+h][s+n]&&(t[i+h][s+n]=e[h][n]);return t}is_lose(){for(let t=0;t<this.x;t++)if(0!==this.map[0][t])return!0;return!1}get state(){return{map:this.build_map_for_render(),next_piese:this.next_piese,score:this.score}}}class r{constructor(t,e,s,i){this.parent=t,this.amount_cells_width=s,this.amount_cells_height=i,this.cell=e,this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","canv"),this.canvas.width=this.amount_cells_width*this.cell,this.canvas.height=(this.amount_cells_height+3)*this.cell,this.context=this.canvas.getContext("2d"),this.parent.appendChild(this.canvas),this.palette={1:"#00f0f0",2:"#a000f0",3:"#f0a000",4:"#0000f0",5:"#f0f000",6:"#00f000",7:"#f00000"}}render_playfield(t,e,s){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drow_top_border(),this.drow_blocks(t),this.drow_next_block(e),this.drow_score(s)}drow_blocks(t){for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)0!==t[e][s]&&(this.context.beginPath(),this.context.strokeStyle="black",this.context.fillStyle=this.palette[t[e][s]],this.context.fillRect(s*this.cell,(e+3)*this.cell,this.cell,this.cell),this.context.strokeRect(s*this.cell,(e+3)*this.cell,this.cell,this.cell))}drow_next_block(t){const e=this.cell/1.5;if(t)for(let s=0;s<t.piese.el.length;s++)for(let i=0;i<t.piese.el[s].length;i++)0!==t.piese.el[s][i]&&(this.context.beginPath(),this.context.strokeStyle="black",this.context.fillStyle=this.palette[t.piese.el[s][i]],this.context.fillRect(4.5*this.cell+i*e,this.cell/2+s*e,e,e),this.context.strokeRect(4.5*this.cell+i*e,this.cell/2+s*e,e,e))}drow_score(t){this.context.font="25px Verdana",this.context.fillText(t,20,50)}drow_top_border(){this.context.beginPath(),this.context.moveTo(0,3*this.cell),this.context.lineTo(this.amount_cells_width*this.cell,3*this.cell),this.context.stroke()}drow_loser(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font="25px Verdana",this.context.textAlign="center",this.context.fillText(t,this.amount_cells_width*this.cell/2,100),this.context.fillText("Click to restart",this.amount_cells_width*this.cell/2,200)}}const a=document.querySelector(".game"),l=document.querySelector(".control"),c=document.querySelector(".header_score"),_={};let u=35;function p(){localStorage.getItem("tetris_score")&&(c.textContent="Your best score: "+localStorage.getItem("tetris_score")),_.data=new o(8,12),_.playfield=new r(a,u,8,12),_.meneger=new h(_.data,_.playfield,l,u,8,d),_.meneger.set_game_circle()}function d(){document.querySelectorAll("canvas").forEach(t=>t.remove()),p()}window.innerWidth<600&&(u=(window.innerWidth-window.innerWidth/2)/8),p()}]);